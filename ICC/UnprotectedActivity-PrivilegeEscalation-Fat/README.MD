# Summary
The Firefox Crash Reporter can recieve an intent to send any file to a server of the attackers choosing.

# Android versions affected
Tested on Android 16

# Description of vulnerability and corresponding exploit
Apps exporting activities that perform sensitive actions are vulnerable to be misused/hijacked by malicious apps.

*Issue:* If an app performs sensitive action (e.g., file transfer) in activities that are not well-protected, then malicious apps can exploit such activities to perform privileged actions

Before Version 28, Firefox for Android (and Firefox Beta for Android) exported the CrashReporter activity. Given the path to a file as an extra intent parameter, it uploads the file to a server named in another file with a predefined name and path. By placing the files in a folder that is accessible to FireFox and sending an intent to the CrashReporter with the path to the file to be sent, an attacker can hijack the CrashReporter to send the files to an arbitrary server.

*Example:*  The malicious app contains an intent targetting the crashreporter. The CrashReporter activity is "org.mozilla.gecko.CrashReporter" and the package name is "org.mozilla.firefox_beta". If the targetted directory has a file ending in .dmp, and a file ending in .extra that contains "ServerAddress=[IP]", then the attacker can hijack the crash reporter to send the firefox log and the files to a server of their choosing.  The app points this to a local host Flask server (app.py) since the file is sent through a POST request. The file attatched to this is a .gz archive, and if successful contains all the files ending in .dmp and the firefox log. 


# Steps to build the sample apps and to exploit the vulnerability

1. Setup a local Web Server. We have used Flask here. If you want to use Flask follow the instructions [here](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/src/76cc87180f064b328c37cc57b5c743dba378a5de/Misc/LocalServer/README.md?at=master&fileviewer=file-view-default).

2. list targets:

    `$ android list targets`

3. List available Android Virtual Devices:

    `$ android list avd`

4. Create an emulator:

    `$ android create avd -n <name> -k <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

5. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

6. Install *FirefoxBeta*:

    `$ cd FirefoxBeta`

    `$ adb install FirefoxBeta`

7. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installAPI16Debug`

8. Launch *Malicious* in the emulator where it is installed. 

    Upon clicking the "Launch" Button the firefox crash reporter should open. Clicking close or restart while leaving send report checked should send the file to the server.


# References

1.  Related to [Issue #54](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/issues/54/explore-cve-2014-1506-to-add-new-lean-and)
2. 	https://bug944374.bmoattachments.org/attachment.cgi?id=8339914
3. 	https://www.mozilla.org/en-US/security/advisories/mfsa2014-24/
4.  https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1506
